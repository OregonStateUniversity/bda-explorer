<%= form_for(@project, html: {multipart: true}) do |f| %>

<%= form_errors_for(@project) %>
<div class="row">
  <div class="col-md">
    <!-- PROJECT NAME -->
    <%= f.label :name, 'Project Name' %>
    <div class="btn btn-question" id="name-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :name, autofocus: true, autocomplete: 'off', placeholder: 'e.g. Bridge Creek Incision Recovery', class: 'form-control' %>
  </div>
    <div class="col-md">
    <!-- PRIMARY CONTACT -->
    <%= f.label :primary_contact, 'Primary Contact Name' %>
    <div class="btn btn-question" id="primary_contact-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :primary_contact, autofocus: true, autocomplete: 'off', placeholder: 'e.g. Jane Doe', class: 'form-control' %>
  </div>
</div>
<div class="row">
  <div class="col-md">
    <!-- URL -->
    <%= f.label :url, 'Project URL' %>
    <div class="btn btn-question" id="url-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :url, autofocus: true, autocomplete: 'off', placeholder: 'e.g. https://www.anabranchsolutions.com/beaver-dam-analogs.html', class: 'form-control' %>
  </div>
  <div class="col-md">
    <!-- PROJECT AFFILIATION -->
    <%= f.label :organization, 'Affiliated Project Organizations(s)' %>
    <div class="btn btn-question" id="affiliation-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>

    <div class = "selectWrapper">
    <%#= f.select :organization_ids,
    Organization.all.order(:name).map { |u| [u.name, u.id] },
               { include_blank: true, multiple: true},
               { class: 'chosen-select', multiple: true }
    %>
    </div>
    <%= f.select :organization_ids, Organization.all %>
  </div>
</div>

<div class="row">
  <div class="col-md">
    <!-- STREAM NAME -->
    <%= f.label :stream_name, 'Stream Name' %>
    <div class="btn btn-question" id="stream_name-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :stream_name, autofocus: true, autocomplete: 'off', placeholder: 'Bear Creek', class: 'form-control' %>
  </div>
  <div class="col-md">
    <!-- WATERSHED -->
    <%= f.label :watershed, 'Project Watershed' %>
    <div class="btn btn-question" id="watershed-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :watershed, autofocus: true, autocomplete: 'off', placeholder: 'e.g. John Day', class: 'form-control' %>
  </div>
</div>
<div class="row">
  <div class="col-md">
    <!-- LATITUDE -->
    <%= f.label :latitude %>
    <div class="btn btn-question" id="latitude-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :latitude, autocomplete: 'off', placeholder: 'e.g. 44.103436', class: 'form-control' %>
  </div>
  <div class="col-md">
    <!-- LONGITUDE -->
    <%= f.label :longitude %>
    <div class="btn btn-question" id="longitude-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :longitude, autocomplete: 'off', placeholder: 'e.g. -121.769211', class: 'form-control' %>
  </div>
</div>
<div class="row">
  <div class="col-md">
    <%# Sends the peak of Three Sisters as default coordinates if @project.lonlat is nil %>
    <div 
      data-latitude="<%=@project.lonlat ? @project.lonlat.y : 44.103436 %>" 
      data-longitude="<%=@project.lonlat ? @project.lonlat.x : -121.769211 %>" 
      id="form-map" 
      class="rounded border border-secondary"
    >
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md">
    <!-- STRUCTURES -->
    <%= f.label :number_of_structures, 'Total LT-PBR Structures' %>
    <div class="btn btn-question" id="number_of_structures-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :number_of_structures, autocomplete: 'off', placeholder: 'e.g. 50', class: 'form-control' %>
  </div>
  <div class="col-md">
    <!-- TREATMENT LENGTH -->
    <%= f.label :length, 'Treatment Length (meters)' %>
    <div class="btn btn-question" id="treatment_length-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.text_field :length, autocomplete: 'off', placeholder: 'e.g. 500', class: 'form-control' %>
  </div>
</div>
<div class="row">
  <div class="col-md">
    <!-- IMPLEMENTATION DATE -->
    <%= f.label :implementation_date, 'Implementation Date' %>
    <div class="btn btn-question" id="implementation_date-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.date_field :implementation_date, autocomplete: 'off', placeholder: 'yyyy-mm-dd', class: 'form-control' %>
  </div>
  <div class="col-md">
    <!-- PROJECT IMAGE -->
    <%= f.label :photos, 'Project Photos' %>
    <div class="btn btn-question" id="photo-help">
      <i class="fa fa-question-circle-o" aria-hidden="true"></i>
    </div>
    <%= f.file_field :photos, multiple: true, accept: 'image/*', class: 'custom-file-control form-control' %>
  </div>
</div>
<!-- NARRATIVE -->
<%= f.label :narrative, 'Project Restoration Goals' %>
<div class="btn btn-question" id="narrative-help">
  <i class="fa fa-question-circle-o" aria-hidden="true"></i>
</div>
<%= f.text_area :narrative, autocomplete: 'off', placeholder: 'Restoration goals for the project. e.g. Expansion of riparian vegetation.', class: 'form-control', rows: 5 %>

<!-- STRUCTURE CONSTRUCTION -->
<%= f.label :structure_description, 'Structure Construction Elements' %>
<div class="btn btn-question" id="structure_description-help">
  <i class="fa fa-question-circle-o" aria-hidden="true"></i>
</div>
<%= f.text_area :structure_description, autocomplete: 'off', placeholder: 'Briefly describe LT-PBR design and/or construction elements.', class: 'form-control', rows: 5 %>

<!-- DELETE EXISTING PHOTOS -->
<% if @project.photos.attached? %>
  <%= f.label :photos, 'Select Existing Photos to Delete' %>
  <div class="btn btn-question" id="delete-photos-help">
    <i class="fa fa-question-circle-o" aria-hidden="true"></i>
  </div>
  <div class="container">
    <div class="row">
      <% @project.photos.each do |photo| %>
        <div class="col-3">
          <label class="image-checkbox rounded">
            <%= image_tag photo, alt: "Project on #{@project.stream_name}", class: 'img-fluid shadow' %>
            <%= check_box_tag "select_delete_photo_ids[]", photo.id %>
            <i class="fa fa-trash bg-dark shadow rounded"></i>
          </label>
        </div>
      <% end %>
    </div>
  </div>
  <script>
    // Initialize state
    $(".image-checkbox").each(function () {
      if ($(this).find('input[type="checkbox"]').first().attr("checked")) {
        $(this).addClass('image-checkbox-checked');
      }
      else {
        $(this).removeClass('image-checkbox-checked');
      }
    });

    // Sync state when image is clicked
    $(".image-checkbox").on("click", function (e) {
      $(this).toggleClass('image-checkbox-checked');
      var $checkbox = $(this).find('input[type="checkbox"]');
      $checkbox.prop("checked",!$checkbox.prop("checked"))

      e.preventDefault();
    });
  </script>
<% end %>

<div class="actions">
  <%= f.submit class: 'btn confirm-btn' %>
</div>

<% end %>

<!-- MODAL INFORMATION -->
<div aria-hidden='true' class='modal fade' id='name-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Project Name</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        <p>Just a simple name for the project e.g:</p>
        <p>"Bear Creek Surface Flow Enhancement", or</p> "Bridge Creek Riparian Uplift"
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL INFORMATION -->
<div aria-hidden='true' class='modal fade' id='photo-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Project Photos</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        <p>Upload at least one representative photo of the project area, channel, or structures.</p>
        <p>Each of the photos must be below 50 MB in size and be in the JPEG, PNG, GIF, BMP, AVIF, or WebP format.</p>
        <p>There is a limit of 20 photos.</p>
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='stream_name-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Stream Name</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Name of the project stream. e.g. Bridge Creek.
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='watershed-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Watershed Name</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Project watershed or sub-watershed. e.g. "John Day"
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='url-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Project URL</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Outside link to existing project. e.g. "https://www.anabranchsolutions.com/beaver-dam-analogs.html"
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='affiliation-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Affiliation</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Primary organization involved with project design and implementation.
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='implementation_date-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Implementation date</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Approximate date of initial structure installation.
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='latitude-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Latitude</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Approximate project LATITUDE in decimal degrees (e.g., 44.23454).
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='longitude-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Longitude</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Approximate project LONGITUDE in decimal degrees (e.g., -122.3456).
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='number_of_structures-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Number of Structures</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Approximate number of structures currently installed or that will be installed in the future.
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='treatment_length-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Treatment length</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Approximate length of stream being treated with LT-PBR structures in meters.
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='narrative-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Narrative</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Briefly describe restoration goals for the project which may include increased fish habitat, riparian expansion, channel aggradation, etc.....
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='primary_contact-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Primary Contact</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Primary contact name for project manager or coordinator. e.g. John Doe
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='structure_description-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Structure Design Elements</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Briefly describe LT-PBR structure design and/or construction elements. e.g., Structures were primarily BDAs, and generally built at a low elevation of 0.25 m. Majority of the structures utilized two post rows and juniper and sagebrush as fill material.
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
<div aria-hidden='true' class='modal fade' id='delete-photos-modal' role='dialog' tabindex='-1'>
  <div class='modal-dialog' role='document'>
    <div class='modal-content'>
      <div class='modal-header'>
        <h5 class='modal-title'>Select Existing Photos to Delete</h5>
        <button aria-label='Close' class='close' data-dismiss='modal' type='button'>
          <span aria-hidden='true'>×</span>
        </button>
      </div>
      <div class='modal-body'>
        Select photos by clicking or tapping on them to mark them for deletion.
      </div>
      <div class='modal-footer'>
        <button class='btn btn-secondary' data-dismiss='modal' type='button'>Close</button>
      </div>
    </div>
  </div>
</div>
